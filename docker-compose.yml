version: '3.8'

# Co-located on Maggie VPS (89.116.157.23)
# Caddy is handled by n0v8v stack — we join its network
# Database: Supabase GP3 project (zoda) — cal schema

services:
  cal-backend:
    build: ./backend
    container_name: cal-backend
    environment:
      DATABASE_URL: ${SUPABASE_DB_URL:-}
      SUPABASE_URL: ${SUPABASE_URL:-https://ezlmmegowggujpcnzoda.supabase.co}
      SUPABASE_KEY: ${SUPABASE_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      SECRET_KEY: ${SECRET_KEY}
      ENVIRONMENT: ${ENVIRONMENT:-production}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY}
      EMAIL_WEBHOOK_SECRET: ${EMAIL_WEBHOOK_SECRET:-}
      MAILGUN_API_KEY: ${MAILGUN_API_KEY:-}
      MAILGUN_DOMAIN: ${MAILGUN_DOMAIN:-gp3.app}
    volumes:
      - ./kernels:/app/kernels:ro
      - cal-uploads:/app/uploads
    ports:
      - "127.0.0.1:8200:8000"
    restart: unless-stopped
    networks:
      - n0v8v_n0v8v-net

volumes:
  cal-uploads:

networks:
  n0v8v_n0v8v-net:
    external: true
